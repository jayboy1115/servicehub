# Emergent Deployment Configuration
version: "1.0"

services:
  frontend:
    type: "react"
    path: "./frontend"
    build:
      command: "npm run build"
      output: "build"
    environment:
      REACT_APP_BACKEND_URL: "${BACKEND_URL}"
      REACT_APP_GOOGLE_MAPS_API_KEY: "${GOOGLE_MAPS_API_KEY}"
      WDS_SOCKET_PORT: "443"
      DANGEROUSLY_DISABLE_HOST_CHECK: "true"
    port: 3000

  backend:
    type: "python"
    path: "./backend"
    runtime: "python3.11"
    start_command: "python server.py"
    environment:
      MONGO_URL: "${MONGO_URL}"
      FRONTEND_URL: "${FRONTEND_URL}"
      TERMII_API_KEY: "${TERMII_API_KEY}"
      SENDGRID_API_KEY: "${SENDGRID_API_KEY}"
      SENDER_EMAIL: "${SENDER_EMAIL}"
      DB_NAME: "test_database"
      CORS_ORIGINS: "*"
      PORT: "${PORT}"
    port: 8001
    health_check:
      path: "/api/health"
      timeout: 30

  database:
    type: "mongodb"
    version: "7.0"
    environment:
      MONGO_INITDB_DATABASE: "servicehub"

deployment:
  strategy: "rolling"
  health_checks: true
  timeout: 300
  
routing:
  - path: "/api/*"
    service: "backend"
  - path: "/*"
    service: "frontend"